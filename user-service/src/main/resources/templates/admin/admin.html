<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üë®‚Äçüíº H·ªá Th·ªëng Qu·∫£n L√Ω Admin</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #e3f2fd, #f0f4f8);
            margin: 0;
            padding: 0;
            color: #333;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #007bff, #00c4b4);
            color: white;
            padding: 30px 20px 80px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
            position: relative;
            overflow: visible;
        }
        .header::before {
            content: "";
            background: url('https://cdn-icons-png.flaticon.com/512/2966/2966487.png') no-repeat center/120px;
            opacity: 0.15;
            position: absolute;
            inset: 0;
        }
        .header h1 {
            margin: 0;
            font-size: 38px;
            font-weight: bold;
            position: relative;
            z-index: 1;
        }
        .header p {
            margin: 10px 0 0;
            font-size: 18px;
            opacity: 0.95;
            position: relative;
            z-index: 1;
        }

        /* Top-right menu */
        .top-menu {
            position: absolute;
            top: 20px;
            right: 25px;
            display: flex; 
            align-items: center;
            gap: 15px; 
            z-index: 1000; 
        }
        .menu-item {
            position: relative;
        }
        .icon-btn {
            font-size: 20px;
            background: transparent;
            color: #fff;
            cursor: pointer;
            width: 42px;
            height: 42px;
            border: 2px solid #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s, transform 0.2s;
            position: relative; 
        }
        .icon-btn:hover {
            background: rgba(255,255,255,0.25);
            transform: scale(1.08);
        }
        .notification-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            background-color: #dc3545; 
            color: white;
            border-radius: 50%;
            padding: 4px 7px;
            font-size: 10px;
            font-weight: bold;
            border: 2px solid white;
            line-height: 1;
            z-index: 10;
        }

        /* Dropdown */
        .dropdown {
            display: none;
            position: absolute;
            right: 0;
            background: white;
            color: #333;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.25);
            margin-top: 10px;
            min-width: 300px;
            max-height: 500px;
            overflow-y: auto;
            scrollbar-width: thin;
            z-index: 999;
        }
        .dropdown-header {
            font-weight: bold;
            color: #007bff;
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
        }
        .dropdown a.dropdown-item {
            display: block;
            padding: 10px 15px;
            text-decoration: none;
            color: #333;
            font-size: 14px;
            border-bottom: 1px solid #eee;
            transition: background 0.3s;
        }
        .dropdown a.dropdown-item:hover { background: #f1f1f1; }
        .menu-item.active .dropdown { display: block; }

        /* Container */
        .container {
            max-width: 1200px;
            width: 100%;
            background: white;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.2);
            padding: 40px;
            animation: fadeIn 0.6s ease-in-out;
            margin: -60px auto 40px;
            position: relative;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 30px;
            flex-wrap: wrap;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px);}
            to { opacity: 1; transform: translateY(0);}
        }
        .text-content { flex: 1 1 400px; }
        h1.section-title {
            color: #1a3c64;
            font-size: 30px;
            margin-bottom: 15px;
            text-align: center;
            position: relative;
        }
        h1.section-title::after {
            content: '';
            width: 60px; height: 4px;
            background: #2196f3;
            position: absolute;
            bottom: -10px; left: 50%;
            transform: translateX(-50%);
            border-radius: 2px;
        }
        .welcome-message {
            text-align: center;
            color: #333;
            font-size: 18px;
            margin-bottom: 35px;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 20px;
        }
        .card {
            background: #f5faff;
            padding: 25px 20px;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
        }
        .card:hover {
            transform: translateY(-6px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            background: #e3f2fd;
        }
        .card i { font-size: 45px; color: #2196f3; margin-bottom: 15px; transition: transform 0.3s; }
        .card:hover i { transform: scale(1.15) rotate(5deg); }
        .card h3 { color: #1a3c64; font-size: 20px; margin-bottom: 10px; }
        .card p { color: #555; font-size: 14px; }

        .illustration { flex: 1 1 300px; text-align: center; }
        .illustration img { max-width: 280px; width: 100%; border-radius: 12px; }

        .footer {
            text-align: center;
            padding: 25px;
            margin-top: auto;
            background: linear-gradient(135deg, #007bff, #00c4b4);
            color: white;
            font-size: 14px;
        }
        .footer a { color: #ffeb3b; text-decoration: none; }
        .footer a:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <div class="header">
        <h1>B·ªánh Vi·ªán XYZ - Qu·∫£n L√Ω Admin</h1>
        <p>Qu·∫£n l√Ω b√°c sƒ© v√† b·ªánh nh√¢n v·ªõi hi·ªáu qu·∫£ t·ªëi ∆∞u</p>
        
        <div class="top-menu">
            <div class="menu-item" id="notificationMenu">
                <div class="icon-btn notification-icon">
                    <i class="fa-solid fa-bell"></i>
                    <span class="notification-badge" id="notificationBadge">3</span>
                </div>
                <div class="dropdown" id="notificationDropdown">
                    <div class="dropdown-header">üîî Th√¥ng b√°o m·ªõi</div>
                    <div id="notificationList"></div>
                    <a href="#" class="dropdown-item" style="text-align: center; color: #007bff;">Xem t·∫•t c·∫£</a>
                </div>

            </div>
            
            <div class="menu-item" id="userMenu">
                <div class="icon-btn user-icon"><i class="fa-solid fa-user-tie"></i></div>
                <div class="dropdown" style="min-width: 180px;">
                    <div id="userDisplay" style="padding:10px 15px; font-weight:bold; color:#007bff;">üë§ Admin</div>
                    <a href="#" class="dropdown-item" onclick="logout()"><i class="fa-solid fa-right-from-bracket"></i> ƒêƒÉng xu·∫•t</a>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="text-content">
            <h1 class="section-title">Trang Ch·ªß Admin</h1>
            <div class="welcome-message">
                <p id="welcomeText">üë®‚Äçüíº Ch√†o m·ª´ng Admin!</p>
            </div>
            <div class="dashboard">
                <div class="card" onclick="goTo('/admin/bacsi')">
                    <i class="fa-solid fa-user-md"></i>
                    <h3>Qu·∫£n L√Ω B√°c Sƒ©</h3>
                    <p>Xem v√† qu·∫£n l√Ω th√¥ng tin b√°c sƒ©</p>
                </div>
                <div class="card" onclick="goTo('/admin/benhnhan')">
                    <i class="fa-solid fa-user-injured"></i>
                    <h3>Qu·∫£n L√Ω B·ªánh Nh√¢n</h3>
                    <p>Tra c·ª©u v√† c·∫≠p nh·∫≠t h·ªì s∆° b·ªánh nh√¢n</p>
                </div>
                <div class="card" onclick="goTo('/admin/baocao')">
                    <i class="fa-solid fa-chart-line"></i>
                    <h3>B√°o C√°o & Th·ªëng K√™</h3>
                    <p>Xem b√°o c√°o ho·∫°t ƒë·ªông c·ªßa b·ªánh vi·ªán</p>
                </div>
                <div class="card" onclick="goTo('/admin/khoa')">
                    <i class="fa-solid fa-building"></i>
                    <h3>Qu·∫£n L√Ω Khoa</h3>
                    <p>Qu·∫£n l√Ω th√¥ng tin c√°c khoa trong b·ªánh vi·ªán</p>
                </div>
            </div>
        </div>

        <div class="illustration">
            <img src="https://cdn-icons-png.flaticon.com/512/2921/2921830.png" alt="Admin Illustration">
        </div>
    </div>

    <div class="footer">
        <p>&copy; 2025 B·ªánh Vi·ªán XYZ. M·ªçi quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.</p>
        <p>Li√™n h·ªá: <a href="tel:0915737863">0915737863</a> | Email: <a href="mailto:support@benhvienxyz.vn">support@benhvienxyz.vn</a></p>
        <p>ƒê·ªãa ch·ªâ: 123 ƒê∆∞·ªùng Y√™n Tr√°c, Y√™n Nghƒ©a, H√† N·ªôi</p>
    </div>

    <script>
        // ‚úÖ Ki·ªÉm tra ƒëƒÉng nh·∫≠p khi t·∫£i trang
        document.addEventListener("DOMContentLoaded", () => {
            const userId = localStorage.getItem("userId");
            const username = localStorage.getItem("username");
            const role = localStorage.getItem("role");

            if (!userId || !username || !role) {
                alert("Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i!");
                window.location.href = "/login"; // ƒê·ªãnh tuy·∫øn qua API Gateway
                return;
            }

            // ‚úÖ Hi·ªÉn th·ªã t√™n user
            document.getElementById("userDisplay").innerHTML = `üë§ ${username} (${role})`;
            document.getElementById("welcomeText").textContent = `üëã Ch√†o m·ª´ng ${username}!`;
        });

        // ‚úÖ Chuy·ªÉn trang qua gateway
        function goTo(path) {
            window.location.href = `http://localhost:8080${path}`;
        }

        // ‚úÖ ƒêƒÉng xu·∫•t
        function logout() {
            localStorage.clear();
            alert("ƒê√£ ƒëƒÉng xu·∫•t!");
            window.location.href = "/login";
        }

        // ‚úÖ Dropdown logic
        document.addEventListener("DOMContentLoaded", function() {
            const menuItems = document.querySelectorAll(".menu-item");
            const notificationBadge = document.getElementById("notificationBadge");

            menuItems.forEach(menu => {
                const iconBtn = menu.querySelector(".icon-btn");
                iconBtn.addEventListener("click", function(e) {
                    e.stopPropagation();
                    menuItems.forEach(m => { if (m !== menu) m.classList.remove("active"); });
                    menu.classList.toggle("active");
                    if (menu.id === 'notificationMenu' && menu.classList.contains("active")) {
                        if (notificationBadge) notificationBadge.style.display = 'none';
                    }
                });
            });

            document.addEventListener("click", function() {
                menuItems.forEach(m => m.classList.remove("active"));
            });
        });
// üì® L·∫•y th√¥ng b√°o t·ª´ backend & hi·ªÉn th·ªã
async function loadNotifications() {
    const userId = localStorage.getItem("userId");
    if (!userId) return;

    try {
        const response = await fetch(`http://localhost:8080/notification-service/api/notifications/user/${userId}`);
        if (!response.ok) throw new Error("Kh√¥ng th·ªÉ t·∫£i th√¥ng b√°o");

        const notifications = await response.json();
        const listContainer = document.getElementById("notificationList");
        const badge = document.getElementById("notificationBadge");
        listContainer.innerHTML = "";

        if (notifications.length === 0) {
            listContainer.innerHTML = `<p style="padding:10px; text-align:center; color:#888;">Kh√¥ng c√≥ th√¥ng b√°o n√†o</p>`;
            badge.style.display = "none";
            return;
        }

        // üî¢ C·∫≠p nh·∫≠t badge (ƒë·∫øm ch∆∞a ƒë·ªçc)
        const unreadCount = notifications.filter(n => !n.read).length;
        badge.textContent = unreadCount;
        badge.style.display = unreadCount > 0 ? "block" : "none";

        // üßæ Hi·ªÉn th·ªã danh s√°ch th√¥ng b√°o
        notifications
            .filter(n => !n.read)  // ch·ªâ hi·ªÉn th·ªã th√¥ng b√°o ch∆∞a ƒë·ªçc
            .slice(-10)
            .reverse()
            .forEach(noti => {
                const item = document.createElement("div");
                item.classList.add("dropdown-item");
                item.style.display = "flex";
                item.style.justifyContent = "space-between";
                item.style.alignItems = "center";
                item.innerHTML = `
                    <div>
                        <i class="fa-solid fa-circle-info"></i>
                        ${noti.message}<br>
                        <small style="color:gray;">${new Date(noti.createdAt).toLocaleString()}</small>
                    </div>
                    <button class="mark-read-btn" title="ƒê√°nh d·∫•u ƒë√£ ƒë·ªçc">‚úì</button>
                `;

                const btn = item.querySelector(".mark-read-btn");
                btn.style.background = "#28a745";
                btn.style.color = "white";
                btn.style.border = "none";
                btn.style.borderRadius = "50%";
                btn.style.width = "22px";
                btn.style.height = "22px";
                btn.style.cursor = "pointer";
                btn.style.fontWeight = "bold";
                btn.style.transition = "0.2s";
                btn.addEventListener("mouseenter", () => btn.style.opacity = "0.8");
                btn.addEventListener("mouseleave", () => btn.style.opacity = "1");

                // ‚úÖ Khi b·∫•m n√∫t t√≠ch
                btn.addEventListener("click", async (e) => {
                    e.stopPropagation();
                    try {
                        await fetch(`http://localhost:8080/notification-service/api/notifications/${noti.id}/read`, {
                            method: "PUT",
                        });
                        // ·∫®n th√¥ng b√°o kh·ªèi dropdown
                        item.remove();
                        // Gi·∫£m badge
                        const currentCount = parseInt(badge.textContent) || 1;
                        const newCount = Math.max(currentCount - 1, 0);
                        badge.textContent = newCount;
                        if (newCount === 0) badge.style.display = "none";
                    } catch (err) {
                        alert("‚ùå L·ªói khi c·∫≠p nh·∫≠t tr·∫°ng th√°i ƒë√£ ƒë·ªçc!");
                        console.error(err);
                    }
                });

                listContainer.appendChild(item);
            });

        // N·∫øu t·∫•t c·∫£ ƒë·ªÅu ƒë·ªçc h·∫øt
        if (listContainer.children.length === 0) {
            listContainer.innerHTML = `<p style="padding:10px; text-align:center; color:#888;">Kh√¥ng c√≥ th√¥ng b√°o ch∆∞a ƒë·ªçc</p>`;
        }

    } catch (err) {
        console.error("L·ªói khi t·∫£i th√¥ng b√°o:", err);
        document.getElementById("notificationList").innerHTML =
            `<p style="padding:10px; color:red;">L·ªói t·∫£i th√¥ng b√°o</p>`;
    }
}

// üîÅ G·ªçi khi load trang & t·ª± ƒë·ªông refresh m·ªói 10 gi√¢y
document.addEventListener("DOMContentLoaded", loadNotifications);
setInterval(loadNotifications, 10000);

    </script>
</body>
</html>
