<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Đặt Lịch Khám - Bước 3: Điền Thông Tin Bệnh Nhân</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #f4f7fa;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      color: #333;
    }
    .container {
      background-color: #ffffff;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      padding: 40px;
      max-width: 800px;
      width: 100%;
      text-align: center;
    }
    h1 { font-size: 28px; color: #007bff; margin-bottom: 10px; }
    p.step-info { font-size: 16px; color: #6c757d; margin-bottom: 20px; }
    .selected-info {
      background-color: #e8f5e9;
      border: 1px solid #28a745;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 30px;
      font-size: 16px;
      color: #28a745;
      text-align: left;
    }
    .form-group { margin-bottom: 20px; text-align: left; }
    .form-group label {
      display: block;
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 8px;
      color: #333;
    }
    .form-group input,
    .form-group select {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      box-sizing: border-box;
    }
    .form-group input:focus,
    .form-group select:focus {
      border-color: #007bff;
      outline: none;
    }
    .error-message {
      color: #dc3545;
      font-size: 14px;
      margin-top: 5px;
      display: none;
    }
    .navigation {
      display: flex;
      justify-content: space-between;
      margin-top: 30px;
    }
    .back-btn, .next-btn {
      background-color: #6c757d;
      color: white;
      border: none;
      padding: 12px 30px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    .back-btn:hover { background-color: #545b62; }
    .next-btn { background-color: #007bff; }
    .next-btn:hover { background-color: #0056b3; }
    .next-btn:disabled { background-color: #ccc; cursor: not-allowed; }
    @media (max-width: 600px) {
      .container { padding: 20px; }
      .navigation { flex-direction: column; gap: 10px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Đặt Lịch Khám Bệnh</h1>
    <p class="step-info">Bước 3: Điền thông tin bệnh nhân để hoàn tất đặt lịch khám.</p>

    <div class="selected-info" id="selectedInfo">
      <div><strong>Khoa:</strong> -</div>
      <div><strong>Ngày khám:</strong> -</div>
      <div><strong>Giờ khám:</strong> -</div>
    </div>

    <!-- Họ và tên -->
    <div class="form-group">
      <label for="fullName">Họ và tên <span style="color: #dc3545;">*</span></label>
      <input type="text" id="fullName" placeholder="Nhập họ và tên" required>
      <div id="fullNameError" class="error-message">Vui lòng nhập họ và tên hợp lệ.</div>
    </div>

    <!-- Giới tính -->
    <div class="form-group">
      <label for="gender">Giới tính <span style="color: #dc3545;">*</span></label>
      <select id="gender" required>
        <option value="" disabled selected>Chọn giới tính</option>
        <option value="male">Nam</option>
        <option value="female">Nữ</option>
        <option value="other">Khác</option>
      </select>
      <div id="genderError" class="error-message">Vui lòng chọn giới tính.</div>
    </div>

    <!-- Số điện thoại -->
    <div class="form-group">
      <label for="phone">Số điện thoại <span style="color: #dc3545;">*</span></label>
      <input type="tel" id="phone" placeholder="Nhập số điện thoại" required>
      <div id="phoneError" class="error-message">Số điện thoại không hợp lệ (10 số).</div>
    </div>

    <!-- Địa chỉ -->
    <div class="form-group">
      <label for="address">Địa chỉ <span style="color: #dc3545;">*</span></label>
      <input type="text" id="address" placeholder="Nhập địa chỉ" required>
      <div id="addressError" class="error-message">Vui lòng nhập địa chỉ.</div>
    </div>

    <div class="navigation">
      <button class="back-btn" onclick="goBack()">Quay Lại Bước 2</button>
      <button class="next-btn" id="nextStep" disabled>Tiếp Theo - Bước 4: Xác Nhận</button>
    </div>
  </div>

  <script>
    const formInputs = {
      fullName: document.getElementById('fullName'),
      gender: document.getElementById('gender'),
      phone: document.getElementById('phone'),
      address: document.getElementById('address')
    };

    const errors = {
      fullName: document.getElementById('fullNameError'),
      gender: document.getElementById('genderError'),
      phone: document.getElementById('phoneError'),
      address: document.getElementById('addressError')
    };

    const nextBtn = document.getElementById('nextStep');
    let bookingData = { deptId: null, deptName: '-', date: '-', time: '-' };

    function validateFullName() {
      const value = formInputs.fullName.value.trim();
      if (value.length < 2) { errors.fullName.style.display = 'block'; return false; }
      errors.fullName.style.display = 'none'; return true;
    }

    function validateGender() {
      const value = formInputs.gender.value;
      if (!value) { errors.gender.style.display = 'block'; return false; }
      errors.gender.style.display = 'none'; return true;
    }

    function validatePhone() {
      const value = formInputs.phone.value.trim();
      const regex = /^[0-9]{10}$/;
      if (!regex.test(value)) { errors.phone.style.display = 'block'; return false; }
      errors.phone.style.display = 'none'; return true;
    }

    function validateAddress() {
      const value = formInputs.address.value.trim();
      if (value.length < 3) { errors.address.style.display = 'block'; return false; }
      errors.address.style.display = 'none'; return true;
    }

    function validateForm() {
      const valid = validateFullName() && validateGender() && validatePhone() && validateAddress();
      nextBtn.disabled = !valid;
    }

    Object.values(formInputs).forEach(input => {
      input.addEventListener('input', validateForm);
      input.addEventListener('change', validateForm);
    });

    function readParamsToForm() {
      const qs = new URLSearchParams(window.location.search);
      bookingData.deptId = qs.get('deptId');
      bookingData.deptName = qs.get('deptName') || '-';
      bookingData.date = qs.get('date') || '-';
      bookingData.time = qs.get('time') || '-';
      updateSelectedInfo();
    }

    function updateSelectedInfo() {
      document.getElementById('selectedInfo').innerHTML = `
        <div><strong>Khoa:</strong> ${bookingData.deptName}</div>
        <div><strong>Ngày khám:</strong> ${bookingData.date}</div>
        <div><strong>Giờ khám:</strong> ${bookingData.time}</div>
      `;
    }

    function goBack() {
      const params = new URLSearchParams(bookingData).toString();
      window.location.href = `./ngaygio?${params}`;
    }

    nextBtn.addEventListener('click', () => {
      if (nextBtn.disabled) return;
      const patientData = {
        fullName: formInputs.fullName.value,
        gender: formInputs.gender.value,
        phone: formInputs.phone.value,
        address: formInputs.address.value
      };
      const params = new URLSearchParams({
        ...bookingData,
        ...patientData
      }).toString();
      window.location.href = `./xacnhan?${params}`;
    });

    readParamsToForm();
  </script>
</body>
</html>
